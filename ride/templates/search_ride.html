{% extends "base.html" %}

{% block custom_css %}
  <style>
    .map {
      height: 180px;
    }
  </style>
{% endblock %}

{% block content %}

<h1></h1>
  <div class="container justify-content-center align-items-center vh-100">
    <div class="row">
      <h1 class="text-center mt-5">BUSCAR CARONA</h1>
    </div>
    <hr class="my-5">
    <div class="row">
      <div class="col-12">
        <div class="card shadow" style="border-radius: 15px; width: 40%; margin: auto;">
          <div class="card-body text-center">
            <form action="{% url 'ride:search_ride' %}" method="post">

              {% csrf_token %}
              <div class="mb-4">
                <label for="search-start-point-field">Local de Partida:</label>
                <input id="search-start-point-field" class="form-control mb-2" type="text" placeholder="Digite o endereÃ§o..." autocomplete="on" runat="server" />
                <input hidden id="search-start-point-field-city2" />
                <input hidden id="search-start-point-field-city-lat" />
                <input hidden id="search-start-point-field-city-lng" />
                <div class="map" id="starting-point-map"></div>
              </div>
              <div class="mb-4">
                <label for="destination" class="form-label">Destino:</label>
                <input type="text" class="form-control" id="destination" name="destination">
              </div>
              <div class="mb-4">
                <label for="datetime" class="form-label">Data e Hora:</label>
                <input type="datetime-local" class="form-control" id="datetime" name="datetime">
              </div>
              <div class="mb-4">
                <label for="passengers" class="form-label">Quantidade de Passageiros:</label>
                <input type="number" class="form-control" id="passengers" name="passengers">
              </div>
              <button type="submit" class="btn btn-outline-primary btn-rounded btn-lg">Buscar</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

{% endblock %}

{% block custom_js %}
<script src="http://maps.googleapis.com/maps/api/js?&libraries=places&" type="text/javascript"></script>
<script type='text/javascript'>
  function initialize() {
    map = new google.maps.Map(document.getElementById("starting-point-map"), {
        center: { lat: -22.903, lng: -43.132 },
        zoom: 11,
    });

    marker = new google.maps.Marker({
        map,
        position: { lat: -22.903, lng: -43.132 },
        draggable: true,
        animation: google.maps.Animation.DROP
    });

    var input = document.getElementById('search-start-point-field');
    var autocomplete = new google.maps.places.Autocomplete(input);
    google.maps.event.addListener(autocomplete, 'place_changed', function () {
        var place = autocomplete.getPlace();
        if (!place.geometry) {
            return;
        }
        map.panTo(place.geometry.location);
        marker.setPosition(place.geometry.location);
        document.getElementById('search-start-point-field-city2').value = place.name;
        document.getElementById('search-start-point-field-city-lat').value = place.geometry.location.lat();
        document.getElementById('search-start-point-field-city-lng').value = place.geometry.location.lng();
    });

    google.maps.event.addListener(marker, 'dragend', function () {
      var pos = marker.getPosition();
      map.panTo(pos);
      document.getElementById('search-start-point-field-city-lat').value = pos.lat();
      document.getElementById('search-start-point-field-city-lng').value = pos.lng();

      var geocoder = new google.maps.Geocoder();
      geocoder.geocode({ 'location': pos }, function (results, status) {
        if (status === 'OK' && results[0]) {
          input.value = results[0].formatted_address;
          document.getElementById('city2').value = results[0].address_components[0].long_name;
        }
      });
    });
  }

  google.maps.event.addDomListener(window, 'load', initialize);
</script>
{% endblock %}
